<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Guesthouse</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    img { max-width: 100%; border-radius: 4px; }
    .room-select { margin-top: 1rem; }
    label { display: block; margin-top: 1rem; }
    button { margin-top: 1.5rem; padding: .75rem 1.5rem; }
    #total { font-weight: bold; margin-top: 1em; }
  </style>
</head>
<body>
  <h1 id="hotelName">Loading…</h1>
  <img id="hotelImg" src="" alt="">
  <p id="hotelDesc"></p>

  <form id="bookForm">
    <div><strong>Dates:</strong> <span id="dates"></span></div>
    <div><strong>Guests:</strong> <span id="guests"></span></div>

    <label class="room-select">
      Rooms
      <select id="roomCount">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
    </label>

    <label>
      <input type="checkbox" id="transfer"> Include transfer (+ $50 total)
    </label>

    <button type="button" id="calcBtn">Calculate Total</button>
    <div id="total"></div>
  </form>

  <script>
    // pull everything from the URL
    const params  = new URLSearchParams(window.location.search);
    const hotelId = params.get('hotelId');
    const island  = params.get('island');
    const checkIn = params.get('checkin');
    const checkOut = params.get('checkout');
    const adults  = params.get('adults');
    const kids    = params.get('kids');

    // display dates and guests
    document.getElementById('dates').textContent = `${checkIn} → ${checkOut}`;
    document.getElementById('guests').textContent = `${adults} adult(s), ${kids} kid(s)`;

    // load JSON & find that hotel
    fetch('../data/guesthouse.json')
      .then(r => r.json())
      .then(data => {
        const hotel = data.hotels.find(h => h.id === hotelId);
        if (!hotel) throw new Error('Guesthouse not found');

        document.getElementById('hotelName').textContent = hotel.name;
        document.getElementById('hotelDesc').textContent = hotel.description;
        document.getElementById('hotelImg').src = hotel.images[0];
        document.getElementById('hotelImg').alt = hotel.name;

        // room options: show each room type + price
        const select = document.createElement('select');
        select.id = 'roomType';
        hotel.rooms.forEach(rm => {
          const opt = document.createElement('option');
          opt.value = rm.type;
          opt.textContent = `${rm.type} – $${rm.pricePerNight}/night`;
          opt.dataset.price = rm.pricePerNight;
          select.appendChild(opt);
        });
        const lbl = document.createElement('label');
        lbl.textContent = 'Room Type';
        lbl.appendChild(select);
        document.getElementById('bookForm').insertBefore(lbl, document.getElementById('calcBtn'));

      })
      .catch(err => {
        document.body.innerHTML = `<p style="color:red">Error loading data: ${err.message}</p>`;
        console.error(err);
      });

    // helper: nights between two dates
    function nights(a, b) {
      const d1 = new Date(a), d2 = new Date(b);
      return Math.round((d2 - d1) / (1000*60*60*24));
    }

    // on “Calculate Total” click
    document.getElementById('calcBtn').addEventListener('click', () => {
      const roomType = document.getElementById('roomType');
      const pricePerNight = +roomType.selectedOptions[0].dataset.price;
      const numRooms = +document.getElementById('roomCount').value;
      const withTransfer = document.getElementById('transfer').checked;
      const nightsStay = nights(checkIn, checkOut);
      let total = pricePerNight * numRooms * nightsStay;
      if (withTransfer) total += 50;
      document.getElementById('total').textContent =
        `Total for ${nightsStay} night(s): $${total.toFixed(2)}`;
    });
  </script>
</body>
</html>
