<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Guesthouse</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --clr-bg: #f9fafb;
      --clr-accent: #4f46e5;
      --clr-accent-light: #6366f1;
      --clr-border: #e5e7eb;
      --clr-text: #1f2937;
      --clr-input-bg: #ffffff;
      --clr-input-border: #d1d5db;
      --clr-shadow: rgba(0, 0, 0, 0.05);
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--clr-bg);
      color: var(--clr-text);
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
      line-height: 1.6;
    }

    img {
      width: 100%;
      border-radius: 0.5rem;
      box-shadow: 0 4px 8px var(--clr-shadow);
      margin-bottom: 1rem;
    }

    form > div { margin: 0.5rem 0; }

    label { display: block; margin: 1rem 0 0.5rem; font-weight: 500; }

    select, input[type="checkbox"] {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--clr-input-border);
      border-radius: 0.5rem;
      background: var(--clr-input-bg);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      font-size: 1rem;
    }

    select:focus, input[type="checkbox"]:focus {
      border-color: var(--clr-accent);
      box-shadow: 0 0 0 3px rgba(79,70,229,0.2);
      outline: none;
    }

    input[type="checkbox"] { width: auto; margin-right: 0.5rem; }

    #total {
      margin-top: 1.5rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--clr-accent);
      text-align: right;
    }
  </style>
</head>
<body>
  <h1 id="hotelName">Loading…</h1>
  <img id="hotelImg" src="" alt="">
  <p id="hotelDesc"></p>

  <form id="bookForm">
    <div><strong>Dates:</strong> <span id="dates"></span></div>
    <div><strong>Guests:</strong> <span id="guests"></span></div>

    <label for="roomType">Room Type</label>
    <select id="roomType"></select>

    <label for="roomCount">Rooms</label>
    <select id="roomCount">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>

    <label>
      <input type="checkbox" id="transfer">
      Include transfer (+ $50 total)
    </label>
  </form>

  <div id="total">Total: $0.00</div>

  <script>
    // Parse URL params
    const params   = new URLSearchParams(window.location.search);
    const hotelId  = params.get('hotelId');
    const checkIn  = params.get('checkin');
    const checkOut = params.get('checkout');
    const adults   = params.get('adults');
    const kids     = params.get('kids');

    // Display dates and guests
    document.getElementById('dates').textContent  = `${checkIn} → ${checkOut}`;
    document.getElementById('guests').textContent = `${adults} adult(s), ${kids} kid(s)`;

    // Fetch JSON and render hotel info + room types
    fetch('../dhathuru/data/guesthouse.json')
      .then(r => r.json())
      .then(data => {
        const hotel = data.hotels.find(h => h.id === hotelId);
        if (!hotel) throw new Error('Guesthouse not found');

        document.getElementById('hotelName').textContent = hotel.name;
        document.getElementById('hotelDesc').textContent = hotel.description;
        document.getElementById('hotelImg').src         = hotel.images[0];
        document.getElementById('hotelImg').alt         = hotel.name;

        // Populate roomType select
        const roomTypeSel = document.getElementById('roomType');
        hotel.rooms.forEach(rm => {
          const opt = document.createElement('option');
          opt.value         = rm.type;
          opt.textContent   = `${rm.type} – $${rm.pricePerNight}/night`;
          opt.dataset.price = rm.pricePerNight;
          roomTypeSel.appendChild(opt);
        });

        // Attach change listeners & initial update
        ['roomType','roomCount','transfer']
          .forEach(id => document.getElementById(id)
            .addEventListener('change', updateTotal)
          );
        updateTotal();
      })
      .catch(err => {
        console.error(err);
        document.body.innerHTML = `<p style="color:red">Error loading data: ${err.message}</p>`;
      });

    // Helper: calculate nights between two dates
    function nights(a, b) {
      return Math.round((new Date(b) - new Date(a)) / (1000 * 60 * 60 * 24));
    }

    // Calculate and display total automatically
    function updateTotal() {
      const pricePerNight = +document.getElementById('roomType')
        .selectedOptions[0].dataset.price;
      const numRooms      = +document.getElementById('roomCount').value;
      const withTransfer  = document.getElementById('transfer').checked;
      const nightsStay    = nights(checkIn, checkOut);
      let total = pricePerNight * numRooms * nightsStay;
      if (withTransfer) total += 50;
      document.getElementById('total').textContent =
        `Total for ${nightsStay} night(s): $${total.toFixed(2)}`;
    }
  </script>
</body>
</html>
