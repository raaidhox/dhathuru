<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Guesthouse</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --clr-bg: #f9fafb;
      --clr-accent: #4f46e5;
      --clr-border: #e5e7eb;
      --clr-text: #1f2937;
      --clr-input-bg: #ffffff;
      --clr-input-border: #d1d5db;
      --clr-shadow: rgba(0, 0, 0, 0.05);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family:'Inter',sans-serif;
      background:var(--clr-bg);
      color:var(--clr-text);
      max-width:1000px;
      margin:2rem auto;
      padding:0 1rem;
      line-height:1.6;
    }
    h1 { text-align:center; font-size:1.75rem; margin-bottom:1rem; }

    /* Mini search bar */
    #summaryBar {
      background:#fff;
      padding:.75rem 1rem;
      border:1px solid var(--clr-border);
      border-radius:.5rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1rem;
    }
    #summaryText { font-size:.95rem; }
    #editBtn {
      background:var(--clr-input-bg);
      border:1px solid var(--clr-border);
      border-radius:.25rem;
      padding:.5rem 1rem;
      cursor:pointer;
    }

    /* Filter panel (hidden on this page) */
    #filterPanel { display:none; }

    /* Details and rooms */
    #details { display:grid; gap:1.5rem; }
    .hotel-info {
      background:#fff;
      padding:1rem;
      border:1px solid var(--clr-border);
      border-radius:.5rem;
    }
    .hotel-info img {
      width:100%;
      border-radius:.5rem;
      box-shadow:0 4px 8px var(--clr-shadow);
      margin-bottom:1rem;
    }
    .hotel-info p { margin:.5rem 0; }
    .rooms {
      background:#fff;
      padding:1rem;
      border:1px solid var(--clr-border);
      border-radius:.5rem;
    }
    .room {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:.75rem;
    }
    .room-controls {
      display:flex;
      align-items:center;
      gap:.5rem;
    }
    .room-controls button {
      padding:.25rem .5rem;
      border:1px solid var(--clr-border);
      border-radius:.25rem;
      background:#fff;
      cursor:pointer;
    }
    #total {
      text-align:right;
      font-size:1.25rem;
      font-weight:600;
      margin-top:1rem;
    }
    #checkBtn {
      display:block;
      width:100%;
      padding:.75rem;
      background:var(--clr-accent);
      color:#fff;
      text-align:center;
      border:none;
      border-radius:.5rem;
      font-size:1rem;
      margin-top:1rem;
      text-decoration:none;
    }
  </style>
</head>
<body>
  <h1 id="hotelName">Loading…</h1>

  <div id="summaryBar">
    <div id="summaryText"></div>
    <button id="editBtn">Edit search</button>
  </div>
  <div id="filterPanel">
    <!-- hidden on this page -->
  </div>

  <div id="details">
    <div class="hotel-info">
      <img id="hotelImg" src="" alt="">
      <p id="hotelDesc"></p>
    </div>
    <div class="rooms" id="roomsContainer"></div>
  </div>

  <div id="total">Total: $0.00</div>
  <a id="checkBtn" href="" target="_blank">Check Availability</a>

  <script>
    // Helper to compute number of nights
    function nights(a, b) {
      return Math.round((new Date(b) - new Date(a)) / (1000 * 60 * 60 * 24));
    }

    // Read all URL params
    const params      = new URLSearchParams(location.search);
    const hotelId     = params.get('hotelId');
    const island      = params.get('island')      || '';
    const nationality = params.get('nationality') || 'Maldivian';
    const adults      = params.get('adults')      || '1';
    const kids        = params.get('kids')        || '0';
    const checkin     = params.get('checkin')     || '';
    const checkout    = params.get('checkout')    || '';

    // Summary bar elements
    const summaryText = document.getElementById('summaryText');
    const editBtn     = document.getElementById('editBtn');

    // Populate summary text
    summaryText.textContent =
      (island || 'All islands')
      + ' — ' + adults + ' adult(s), ' + kids + ' child(ren)'
      + (checkin ? ' — ' + checkin + ' → ' + checkout : '');

    // Redirect back to results.html with same filters
    editBtn.onclick = () => {
      window.location.href = 'results.html?' + location.search;
    };

    // Data holders
    let roomCounts = {};
    let currentHotel = null;

    // Fetch JSON and render
    fetch('../dhathuru/data/guesthouse.json')
      .then(res => res.json())
      .then(data => {
        // Find this hotel
        const hotel = data.hotels.find(h => h.id === hotelId);
        currentHotel = hotel;

        // Fill in hotel info
        document.getElementById('hotelName').textContent = hotel.name;
        document.getElementById('hotelDesc').textContent = hotel.description;
        document.getElementById('hotelImg').src       = hotel.images[0];

        // Build room selectors
        const roomsDiv = document.getElementById('roomsContainer');
        hotel.rooms.forEach(rm => {
          roomCounts[rm.type] = 0;
          const rate = nationality === 'Foreigner'
                       ? rm.guestPrice
                       : rm.localPrice;

          const div = document.createElement('div');
          div.className = 'room';
          div.innerHTML = `
            <span class="room-name">${rm.type} – $${rate}/night</span>
            <div class="room-controls">
              <button data-type="${rm.type}" class="dec">−</button>
              <span id="count-${rm.type}">0</span>
              <button data-type="${rm.type}" class="inc">＋</button>
            </div>`;
          roomsDiv.append(div);
        });

        // Wire up increment/decrement
        document.querySelectorAll('.inc').forEach(btn => {
          btn.onclick = e => {
            const t = e.target.dataset.type;
            roomCounts[t]++;
            document.getElementById(`count-${t}`).textContent = roomCounts[t];
            updateTotal();
          };
        });
        document.querySelectorAll('.dec').forEach(btn => {
          btn.onclick = e => {
            const t = e.target.dataset.type;
            if (roomCounts[t] > 0) {
              roomCounts[t]--;
              document.getElementById(`count-${t}`).textContent = roomCounts[t];
              updateTotal();
            }
          };
        });

        // Initial total
        updateTotal();

        // Link to your booking form
        document.getElementById('checkBtn').href = 'https://forms.gle/your-google-form';
      });

    // Calculate and display total cost
    function updateTotal() {
      if (!currentHotel) return;
      const nightsStay = nights(checkin, checkout);
      let total = 0;
      currentHotel.rooms.forEach(rm => {
        const cnt  = roomCounts[rm.type];
        const rate = nationality === 'Foreigner'
                     ? rm.guestPrice
                     : rm.localPrice;
        total += cnt * rate * nightsStay;
      });
      document.getElementById('total').textContent = `Total: $${total.toFixed(2)}`;
    }
  </script>
</body>
</html>
